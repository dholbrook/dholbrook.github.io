---
layout: post
title: GWT 2.0 ms1 with Ivy Dependency Resolution
date: 2009-10-25
---

I decided to take a stab at finding out how hard it would be to integrate <a title="Ivy" href="http://ant.apache.org/ivy/" id="v8gb">Ivy</a> with a <a title="GWT" href="http://code.google.com/webtoolkit/" id="q68b">GWT</a> Ant build.<br /><br /><h4>Generate Project</h4>I started out by generating the GWT application with <a title="webAppCreator" href="http://code.google.com/webtoolkit/tutorials/1.6/create.html" id="e.8n">webAppCreator</a>.<br /><br /><blockquote>C:/Programs/gwt-2.0.0-ms1<span style="font-family:Courier New;">/webAppCreator com.mostlyblather.IvyGwt</span><br /><br /></blockquote><h4>Create Ivy Configuration</h4>Next I created the ivy.xml file.  After playing around with a couple of different configurations, I settled on this one.  Any future libraries added to the project would be either assigned to "compile" or "runtime" configurations.  The "compile" runtime would include things like 3rd party GWT libraries.  The "runtime" configuration would be used for dependencies executed in the Servlet container.<br /><br /><br /><i>ivy.xml file:</i><br /><br /><pre name="code" class="brush: xml"><br />&lt;ivy-module version=&quot;2.0&quot;&gt;<br />    &lt;info organisation=&quot;com.mostlyblather&quot; module=&quot;ivygwt&quot;/&gt;<br />    &lt;configurations&gt;<br />      &lt;conf name=&quot;runtime&quot;  description=&quot;needed in servlet container&quot;/&gt;<br />      &lt;conf name=&quot;compile&quot;  description=&quot;needed for compilation (other GWT libraries)&quot;/&gt;<br />      &lt;conf name=&quot;sdk&quot;  description=&quot;GWT SDK (compile time, seperated for Eclipse GWT IDE Integration)&quot;/&gt;        <br />    &lt;/configurations&gt;<br />    &lt;dependencies&gt;<br />      &lt;dependency org=&quot;com.google.gwt&quot; name=&quot;gwt-servlet&quot; rev=&quot;2.0.0-ms1&quot; conf=&quot;runtime-&gt;default&quot;/&gt;<br />      &lt;dependency org=&quot;com.google.gwt&quot; name=&quot;gwt-user&quot; rev=&quot;2.0.0-ms1&quot; conf=&quot;sdk-&gt;default&quot;/&gt;<br />      &lt;dependency org=&quot;com.google.gwt&quot; name=&quot;gwt-dev&quot; rev=&quot;2.0.0-ms1&quot; conf=&quot;sdk-&gt;default&quot;/&gt;<br />    &lt;/dependencies&gt;<br />&lt;/ivy-module&gt;<br /></pre><br /><h4>Modify Ant Build</h4>In order to use the Ivy resolved dependencies, several modifications to build.xml need to be made.<br /><br />First an <a title="automatic ivy installation" href="http://ant.apache.org/ivy/history/latest-milestone/install.html" id="uswj">automatic ivy installation</a> code section.<br /><br /><pre name="code" class="brush: xml"><br />  &lt;property name=&quot;ivy.install.version&quot; value=&quot;2.1.0&quot; /&gt;<br />  &lt;condition property=&quot;ivy.home&quot; value=&quot;${env.IVY_HOME}&quot;&gt;<br />    &lt;isset property=&quot;env.IVY_HOME&quot; /&gt;<br />  &lt;/condition&gt;<br />  &lt;property name=&quot;ivy.home&quot; value=&quot;${user.home}/.ant&quot; /&gt;<br />  &lt;property name=&quot;ivy.jar.dir&quot; value=&quot;${ivy.home}/lib&quot; /&gt;<br />  &lt;property name=&quot;ivy.jar.file&quot; value=&quot;${ivy.jar.dir}/ivy.jar&quot; /&gt;<br /><br />  &lt;target name=&quot;download-ivy&quot; unless=&quot;offline&quot;&gt;<br />    &lt;mkdir dir=&quot;${ivy.jar.dir}&quot;/&gt;<br />      &lt;!-- download Ivy from web site so that it can be used even without any special installation --&gt;<br />      &lt;get src=&quot;http://repo2.maven.org/maven2/org/apache/ivy/ivy/${ivy.install.version}/ivy-${ivy.install.version}.jar&quot;<br />      dest=&quot;${ivy.jar.file}&quot; usetimestamp=&quot;true&quot;/&gt;<br />  &lt;/target&gt;<br /><br />  &lt;target name=&quot;init-ivy&quot; depends=&quot;download-ivy&quot;&gt;<br />    &lt;!-- try to load ivy here from ivy home, in case the user has not already dropped<br />         it into ant&apos;s lib dir (note that the latter copy will always take precedence).<br />         We will not fail as long as local lib dir exists (it may be empty) and<br />         ivy is in at least one of ant&apos;s lib dir or the local lib dir. --&gt;<br />    &lt;path id=&quot;ivy.lib.path&quot;&gt;<br />      &lt;fileset dir=&quot;${ivy.jar.dir}&quot; includes=&quot;*.jar&quot;/&gt;<br />    &lt;/path&gt;<br />    &lt;taskdef resource=&quot;org/apache/ivy/ant/antlib.xml&quot;<br />      uri=&quot;antlib:org.apache.ivy.ant&quot; classpathref=&quot;ivy.lib.path&quot;/&gt;<br />  &lt;/target&gt;<br /></pre>Next, add ivy to the build.xml xml namespace.<br /><br /><pre name="code" class="brush: xml"><br />&lt;project name="IvyGwt" xmlns:ivy="antlib:org.apache.ivy.ant" default="build" basedir="."&gt;<br /></pre><br /><br /><br />Create a new target named "resolve" to actually fetch the needed jars.<br /><br /><pre name="code" class="brush: xml">  <br />&lt;target name="resolve" depends="init-ivy" description="retrieve dependencies with ivy"&gt;<br /> &lt;ivy:retrieve pattern="${ivy.lib.dir}/[conf]/[artifact].[ext]"/&gt;<br />&lt;/target&gt;<br /></pre><br /><br />Additionally create a "resolve" target dependency to the "libs" target.<br /><br /><pre name="code" class="brush: xml">    <br />&lt;target name="libs" depends="resolve" description="Copy libs to WEB-INF/lib"&gt;<br /></pre><br /><br />The property definition "gwt.sdk" is no longer required so it can be removed.<br /><br />The "project.class.path" property has to be changed to pick up the new Ivy provided jars.<br /><br /><pre name="code" class="brush: xml"> <br />  &lt;path id=&quot;project.class.path&quot;&gt;<br />    &lt;pathelement location=&quot;war/WEB-INF/classes&quot;/&gt;<br />    &lt;fileset dir=&quot;lib/compile&quot; includes=&quot;**/*.jar&quot;/&gt;<br />    &lt;fileset dir=&quot;lib/sdk&quot; includes=&quot;**/*.jar&quot;/&gt;<br />  &lt;/path&gt;<br /></pre><br /><br />Target "libs" similarly needs to be updated.  Notice that it is only picking up the "runtime" configuration.<br /><br /><pre name="code" class="brush: xml"> <br />  &lt;target name=&quot;libs&quot; depends=&quot;resolve&quot; description=&quot;Copy libs to WEB-INF/lib&quot;&gt;<br />    &lt;mkdir dir=&quot;war/WEB-INF/lib&quot; /&gt;<br />    &lt;copy todir=&quot;war/WEB-INF/lib&quot; &gt;<br />          &lt;fileset dir=&quot;lib/runtime&quot; includes=&quot;**/*.jar&quot;/&gt;<br />      &lt;/copy&gt;<br />  &lt;/target&gt;<br /></pre><br /><br />The "clean" target has some additional work to do now.<br /><br /><pre name="code" class="brush: xml"> <br />  &lt;target name=&quot;clean&quot; description=&quot;Cleans this project&quot;&gt;<br />    &lt;delete dir=&quot;war/WEB-INF/classes&quot; failonerror=&quot;false&quot; /&gt;    <br />    &lt;delete dir=&quot;war/WEB-INF/lib&quot; failonerror=&quot;false&quot; /&gt;    <br />    &lt;delete dir=&quot;war/ivygwt&quot; failonerror=&quot;false&quot; /&gt;<br />    &lt;delete dir=&quot;lib&quot; failonerror=&quot;false&quot; /&gt;<br />  &lt;/target&gt;<br /></pre><br /><br /><i>Here is the final build.xml</i><br /><br /><pre name="code" class="brush: xml"> <br />&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;<br />&lt;project name=&quot;IvyGwt&quot; xmlns:ivy=&quot;antlib:org.apache.ivy.ant&quot; default=&quot;build&quot; basedir=&quot;.&quot;&gt;<br /><br />  &lt;path id=&quot;project.class.path&quot;&gt;<br />    &lt;pathelement location=&quot;war/WEB-INF/classes&quot;/&gt;<br />      &lt;fileset dir=&quot;lib/compile&quot; includes=&quot;**/*.jar&quot;/&gt;<br />      &lt;fileset dir=&quot;lib/sdk&quot; includes=&quot;**/*.jar&quot;/&gt;<br />  &lt;/path&gt;<br /><br />  &lt;property name=&quot;ivy.install.version&quot; value=&quot;2.1.0&quot; /&gt;<br />  &lt;condition property=&quot;ivy.home&quot; value=&quot;${env.IVY_HOME}&quot;&gt;<br />    &lt;isset property=&quot;env.IVY_HOME&quot; /&gt;<br />  &lt;/condition&gt;<br />  &lt;property name=&quot;ivy.home&quot; value=&quot;${user.home}/.ant&quot; /&gt;<br />  &lt;property name=&quot;ivy.jar.dir&quot; value=&quot;${ivy.home}/lib&quot; /&gt;<br />  &lt;property name=&quot;ivy.jar.file&quot; value=&quot;${ivy.jar.dir}/ivy.jar&quot; /&gt;<br /><br />  &lt;target name=&quot;download-ivy&quot; unless=&quot;offline&quot;&gt;<br />    &lt;mkdir dir=&quot;${ivy.jar.dir}&quot;/&gt;<br />      &lt;!-- download Ivy from web site so that it can be used even without any special installation --&gt;<br />      &lt;get src=&quot;http://repo2.maven.org/maven2/org/apache/ivy/ivy/${ivy.install.version}/ivy-${ivy.install.version}.jar&quot;<br />      dest=&quot;${ivy.jar.file}&quot; usetimestamp=&quot;true&quot;/&gt;<br />  &lt;/target&gt;<br /><br />  &lt;target name=&quot;init-ivy&quot; depends=&quot;download-ivy&quot;&gt;<br />    &lt;!-- try to load ivy here from ivy home, in case the user has not already dropped<br />         it into ant&apos;s lib dir (note that the latter copy will always take precedence).<br />         We will not fail as long as local lib dir exists (it may be empty) and<br />         ivy is in at least one of ant&apos;s lib dir or the local lib dir. --&gt;<br />    &lt;path id=&quot;ivy.lib.path&quot;&gt;<br />      &lt;fileset dir=&quot;${ivy.jar.dir}&quot; includes=&quot;*.jar&quot;/&gt;<br />    &lt;/path&gt;<br />    &lt;taskdef resource=&quot;org/apache/ivy/ant/antlib.xml&quot;<br />      uri=&quot;antlib:org.apache.ivy.ant&quot; classpathref=&quot;ivy.lib.path&quot;/&gt;<br />  &lt;/target&gt;<br /> <br />  &lt;target name=&quot;resolve&quot; depends=&quot;init-ivy&quot; description=&quot;retrieve dependencies with ivy&quot;&gt;<br />    &lt;mkdir dir=&quot;lib/runtime&quot; /&gt;<br />    &lt;mkdir dir=&quot;lib/compile&quot; /&gt;<br />    &lt;mkdir dir=&quot;lib/sdk&quot; /&gt;<br />    &lt;ivy:retrieve pattern=&quot;${ivy.lib.dir}/[conf]/[artifact].[ext]&quot;/&gt;<br />  &lt;/target&gt;<br /> <br />  &lt;target name=&quot;libs&quot; depends=&quot;resolve&quot; description=&quot;Copy libs to WEB-INF/lib&quot;&gt;<br />    &lt;mkdir dir=&quot;war/WEB-INF/lib&quot; /&gt;<br />    &lt;copy todir=&quot;war/WEB-INF/lib&quot; &gt;<br />          &lt;fileset dir=&quot;lib/runtime&quot; includes=&quot;**/*.jar&quot;/&gt;<br />      &lt;/copy&gt;<br />  &lt;/target&gt;<br /><br />  &lt;target name=&quot;javac&quot; depends=&quot;libs&quot; description=&quot;Compile java source&quot;&gt;<br />    &lt;mkdir dir=&quot;war/WEB-INF/classes&quot;/&gt;<br />    &lt;javac srcdir=&quot;src&quot; includes=&quot;**&quot; encoding=&quot;utf-8&quot;<br />        destdir=&quot;war/WEB-INF/classes&quot;<br />        source=&quot;1.5&quot; target=&quot;1.5&quot; nowarn=&quot;true&quot;<br />        debug=&quot;true&quot; debuglevel=&quot;lines,vars,source&quot;&gt;<br />      &lt;classpath refid=&quot;project.class.path&quot;/&gt;<br />    &lt;/javac&gt;<br />    &lt;copy todir=&quot;war/WEB-INF/classes&quot;&gt;<br />      &lt;fileset dir=&quot;src&quot; excludes=&quot;**/*.java&quot;/&gt;<br />    &lt;/copy&gt;<br />  &lt;/target&gt;<br /><br />  &lt;target name=&quot;gwtc&quot; depends=&quot;javac&quot; description=&quot;GWT compile to JavaScript&quot;&gt;<br />    &lt;java failonerror=&quot;true&quot; fork=&quot;true&quot; classname=&quot;com.google.gwt.dev.Compiler&quot;&gt;<br />      &lt;classpath&gt;<br />        &lt;pathelement location=&quot;src&quot;/&gt;<br />        &lt;path refid=&quot;project.class.path&quot;/&gt;<br />      &lt;/classpath&gt;<br />      &lt;!-- add jvmarg -Xss16M or similar if you see a StackOverflowError --&gt;<br />      &lt;jvmarg value=&quot;-Xmx256M&quot;/&gt;<br />      &lt;!-- Additional arguments like -style PRETTY or -logLevel DEBUG --&gt;<br />      &lt;arg value=&quot;com.mostlyblather.IvyGwt&quot;/&gt;<br />    &lt;/java&gt;<br />  &lt;/target&gt;<br /><br />  &lt;target name=&quot;hosted&quot; depends=&quot;javac&quot; description=&quot;Run hosted mode&quot;&gt;<br />    &lt;java failonerror=&quot;true&quot; fork=&quot;true&quot; classname=&quot;com.google.gwt.dev.HostedMode&quot;&gt;<br />      &lt;classpath&gt;<br />        &lt;pathelement location=&quot;src&quot;/&gt;<br />        &lt;path refid=&quot;project.class.path&quot;/&gt;<br />      &lt;/classpath&gt;<br />      &lt;jvmarg value=&quot;-Xmx256M&quot;/&gt;<br />      &lt;arg value=&quot;-startupUrl&quot;/&gt;<br />      &lt;arg value=&quot;IvyGwt.html&quot;/&gt;<br />      &lt;!-- Additional arguments like -style PRETTY or -logLevel DEBUG --&gt;<br />      &lt;arg value=&quot;com.mostlyblather.IvyGwt&quot;/&gt;<br />    &lt;/java&gt;<br />  &lt;/target&gt;<br /><br />  &lt;target name=&quot;build&quot; depends=&quot;gwtc&quot; description=&quot;Build this project&quot; /&gt;<br /><br />  &lt;target name=&quot;war&quot; depends=&quot;build&quot; description=&quot;Create a war file&quot;&gt;<br />    &lt;zip destfile=&quot;IvyGwt.war&quot; basedir=&quot;war&quot;/&gt;<br />  &lt;/target&gt;<br /><br />  &lt;target name=&quot;clean&quot; description=&quot;Cleans this project&quot;&gt;<br />    &lt;delete dir=&quot;war/WEB-INF/classes&quot; failonerror=&quot;false&quot; /&gt;    <br />    &lt;delete dir=&quot;war/WEB-INF/lib&quot; failonerror=&quot;false&quot; /&gt;    <br />    &lt;delete dir=&quot;war/ivygwt&quot; failonerror=&quot;false&quot; /&gt;<br />    &lt;delete dir=&quot;lib&quot; failonerror=&quot;false&quot; /&gt;<br />  &lt;/target&gt;<br /><br />&lt;/project&gt;<br /></pre>
