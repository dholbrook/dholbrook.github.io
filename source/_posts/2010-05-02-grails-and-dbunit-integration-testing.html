---
layout: post
title: Grails and DBUnit integration testing
date: 2010-05-02
---

<p>I need to do a bit of integration testing with Grails and both of the <a href="http://www.dbunit.org/">DBUnit</a> plugins I found didnâ€™t seem to be maintained.&#160; To create a simple base class for DBUnit based integration tests turned out to be relatively simple to create.</p>  <p>For the purposes of this sample I created a grails project called bookstore with a single domain class called Book in the bookstore package.&#160; This is what book domain class looks like:</p>  <pre class="brush: groovy">package bookstore<br /><br />class Book {<br />    String title<br />    String author<br />}</pre><br /><br /><p>First I had to add the DBUnit dependency to /grails-app/conf/BuildConfig.groovy and also enable the maven central repository.&#160; This is what the grails.project.dependency.resolution section now looks like:</p><br /><br /><pre class="brush: groovy">grails.project.dependency.resolution = {<br />    inherits( &quot;global&quot; ) {<br />    }<br />    log &quot;warn&quot;<br />    repositories {        <br />        grailsPlugins()<br />        grailsHome()<br />        mavenCentral()<br />    }<br />    dependencies {<br />     test 'org.dbunit:dbunit:2.4.7'<br />    }<br />}</pre><br /><br /><p>Next I created a base class for my DBUnit based tests.&#160; I created a class named DbunitGroovyTestCase in /test/integration/bookstore.&#160; The DataSource property named dataSource is injected from the Spring container when the integration tests are run, and I used the DatabaseDataSourceConnection class to create the DBUnit connection.</p><br /><br /><pre class="brush: groovy">package bookstore<br /><br />import javax.sql.DataSource;<br /><br />import org.dbunit.database.DatabaseDataSourceConnection;<br />import org.dbunit.database.IDatabaseConnection;<br />import org.dbunit.dataset.xml.FlatXmlDataSetBuilder<br />import org.dbunit.dataset.xml.FlatXmlDataSet<br />import org.dbunit.dataset.IDataSet<br />import org.dbunit.operation.DatabaseOperation;<br /><br />import groovy.util.GroovyTestCase;<br /><br />class DbunitGroovyTestCase extends GroovyTestCase {<br /><br />    DataSource dataSource<br />    IDatabaseConnection connection<br /><br />    protected void setUp() {<br />        connection = new DatabaseDataSourceConnection(dataSource)<br />        DatabaseOperation.CLEAN_INSERT.execute(connection, dataSet)<br />    }<br /><br />    protected void tearDown(){<br />        connection.close()<br />    }<br /><br />    protected IDataSet getDataSet() {<br />        return new FlatXmlDataSetBuilder().build(new FileInputStream(&quot;test/dbunit/dataset.xml&quot;));<br />    }<br /><br />}</pre><br /><br /><p>Here is a sample data set I created for the book table, located in test/dbunit/dataset.xml:</p><br /><br /><pre class="brush: xml">&lt;dataset&gt;<br />    &lt;book id=&quot;1&quot; version=&quot;1&quot; author=&quot;Mark Twain&quot; title=&quot;The Adventures of Tom Sawyer&quot;/&gt;<br />    &lt;book id=&quot;2&quot; version=&quot;1&quot; author=&quot;Mark Twain&quot; title=&quot;The Prince and the Pauper&quot;/&gt;<br />    &lt;book id=&quot;3&quot; version=&quot;1&quot; author=&quot;Mark Twain&quot; title=&quot;Adventures of Huckleberry Finn&quot;/&gt;<br />    &lt;book id=&quot;4&quot; version=&quot;1&quot; author=&quot;Mark Twain&quot; title=&quot;A Connecticut Yankee in King Arthur's Court&quot;/&gt;<br />&lt;/dataset&gt;</pre><br /><br /><p>Finally here is a sample integration test, located in test/integration/bookstore/BookPersistenceTest.groovy</p><br /><br /><pre class="brush: groovy">package bookstore;<br /><br />import grails.test.*<br /><br />class BookPersistenceTest extends DbunitGroovyTestCase  {<br /><br />    public void testFindAllByAuthor() throws Exception {<br />        def books = Book.findAllByAuthor(&quot;Mark Twain&quot;)<br />        assertEquals(4,books.size)<br />    }<br /><br />    public void testFindByTitle() throws Exception {<br />        def book = Book.findByTitle(&quot;Adventures of Huckleberry Finn&quot;)<br />        assertEquals(&quot;Mark Twain&quot;,book.author)<br />    }<br /><br />}</pre>
